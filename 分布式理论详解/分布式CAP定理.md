# 简述

CAP定理又称CAP原则，指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），最多只能同时三个特性中的两个，三者不可兼得



## 一致性(C)

更新操作成功之后返回客户端，所有节点的数据同一时间严格一致，这就是分布式的一致性



一致性的问题在并发系统中不可避免

- 从客户端来看，一致性指的是并发访问时更新过的数据如何获取的问题
- 从服务端来看，则是更新的数据如何复制到整个系统，保证数据的最终一致性



## 可用性(A)

服务一直可以正常的使用，不会出现操作失败，访问超时等情况。



## 分区容错性(P)

分布式系统对外看做是一个服务，内部由集群组成，在集群中由于 某些节点宕机 或者 网络故障，剩下的机器节点依然能够正常运转



# CAP定理的证明

证明一下，为什么不能同时满足三个特性



假设有两台服务器，一台放着应用A 和 数据库V，另外一台放着应用B和数据库V。两台服务器之间进行数据的同步，保证数据一致性



在满足一致性的情况下，两台服务器数据都是一样的

在满足可用性的情况下，用户不管请求哪一台服务器都是一样的，立即得到响应

在满足分区容错性的情况下，不管哪台机器宕机或者网络不通的情况，都不会影响两个服务器各自的正常运作



假定极端情况下 两台服务器网络没办法通信了。要保证分区容错性的情况下。

客户端发起请求，请求服务器A，如果保证可用性，那么A返回结果，但是没办法同步数据到B，**违背了一致性**

如果等数据同步都B，必须等待网络通畅，这个时候在返回结果就**违背了可用性**



# 取舍策略

分布式系统的初衷就是扩展性，单点故障正常使用。如果丢弃分区容错性，基本上就是去了分布式系统的意义，所有任何分布式系统都是不会丢弃分区容错性的，要么考虑一致性要么考虑可用性。所以就基本上CP组合或者AP组合



CP组合，保证数据强一致，那么分区（P）之间的数据同步无限延长（也就是等待数据同步完成才能访问服务）。



AP组合，保证可用性，很快能够返回结果。节点之间失去联系，为了保证高可用，每个节点之间数据就可能造成不一致，







